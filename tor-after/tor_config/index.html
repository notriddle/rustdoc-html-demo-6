<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="tor-config"><title>tor_config - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="tor_config" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-dev" data-channel="nightly" data-search-js="search-48aa6924f6dddf0b.js" data-settings-js="settings-fe03fdc259827cd2.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-77dede896d6ac08e.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../tor_config/index.html">tor_config</a><span class="version">0.9.6</span></h2></div><div class="sidebar-elems"><ul class="block">
            <li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">tor_config</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/tor_config/lib.rs.html#1-536">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="tor-config"><a href="#tor-config">tor-config</a></h2>
<p>Tools for configuration management in Arti</p>
<h3 id="overview"><a href="#overview">Overview</a></h3>
<p>This crate is part of
<a href="https://gitlab.torproject.org/tpo/core/arti/">Arti</a>, a project to
implement <a href="https://www.torproject.org/">Tor</a> in Rust.</p>
<p>It provides types for handling configuration values,
and general machinery for configuration management.</p>
<h3 id="configuration-in-arti"><a href="#configuration-in-arti">Configuration in Arti</a></h3>
<p>The configuration for the <code>arti</code> command line program,
and other programs which embed Arti reusing the configuration machinery,
works as follows:</p>
<ol>
<li>
<p>We use <a href="sources/struct.ConfigurationSources.html" title="struct tor_config::sources::ConfigurationSources"><code>tor_config::ConfigurationSources</code></a>
to enumerate the various places
where configuration information needs to come from,
and configure how they are to be read.
<code>arti</code> uses <a href="sources/struct.ConfigurationSources.html#method.from_cmdline" title="associated function tor_config::sources::ConfigurationSources::from_cmdline"><code>ConfigurationSources::from_cmdline</code></a>.</p>
</li>
<li>
<p><a href="sources/struct.ConfigurationSources.html#method.load" title="method tor_config::sources::ConfigurationSources::load"><code>ConfigurationSources::load</code></a> actually <em>reads</em> all of these sources,
parses them (eg, as TOML files),
and returns a [<code>config::Config</code>].
This is a tree-structured dynamically typed data structure,
mirroring the input configuration structure, largely unvalidated,
and containing everything in the input config sources.</p>
</li>
<li>
<p>We call one of the <a href="load/fn.resolve.html" title="fn tor_config::load::resolve"><code>tor_config::resolve</code></a> family.
This maps the input configuration data to concrete <code>ConfigBuilder </code>s
for the configuration consumers within the program.
(For <code>arti</code>, that’s <code>TorClientConfigBuilder</code> and <code>ArtiBuilder</code>).
This mapping is done using the <code>Deserialize</code> implementations on the <code>Builder</code>s.
<code>resolve</code> then calls the <code>build()</code> method on each of these parts of the configuration
which applies defaults and validates the resulting configuration.</p>
<p>It is important to call <code>resolve</code> <em>once</em> for <em>all</em> the configuration consumers,
so that it sees a unified view of which config settings in the input
were unrecognized, and therefore may need to be reported to the user.
See the example in the <a href="load/index.html" title="mod tor_config::load"><code>load</code></a> module documentation.</p>
</li>
<li>
<p>The resulting configuration objects (eg, <code>TorClientConfig</code>, <code>ArtiConfig</code>)
are provided to the code that must use them (eg, to make a <code>TorClient</code>).</p>
</li>
</ol>
<p>See the
<a href="load/index.html" title="mod tor_config::load"><code>tor_config::load</code> module-level documentation</a>.
for an example.</p>
<h3 id="facilities-and-approaches-for-particular-situations"><a href="#facilities-and-approaches-for-particular-situations">Facilities and approaches for particular situations</a></h3><h4 id="lists"><a href="#lists">Lists</a></h4>
<p>When the configuration contains a list of items
which the user is likely to want to add entries to piecemeal,
modify, filter, and so on,
use the list builder helper facilities
in the <a href="list_builder/index.html" title="mod tor_config::list_builder">list_builder</a> module.</p>
<h4 id="configuration-items-which-are-conditionally-compiled"><a href="#configuration-items-which-are-conditionally-compiled">Configuration items which are conditionally compiled</a></h4>
<p>If the user requests, via the configuration,
a feature which is compiled out (due to the non-selection of cargo features),
it is usually right to have the code simply ignore it.</p>
<p>This can be achieved by applying the appropriate <code>#[cfg]</code>
to configuration fields and structs.
The result is that if the user <em>does</em> specify the relevant options,
Arti will generate an “unknown configuration item” warning.
(In the future it might be nice to
provide a message saying what feature was missing.)</p>
<h5 id="config-items-which-must-be-detected-and-rejected-even-when-compiled-out"><a href="#config-items-which-must-be-detected-and-rejected-even-when-compiled-out">Config items which must be detected and rejected even when compiled out</a></h5>
<p>For example, if Arti is compiled without bridge support,
a configuration specifying use of bridges should result in failure,
rather than a direct connection.</p>
<p>In those cases, you should 
<em>unconditionally include</em> the configuration fields
which must be detected and rejected.</p>
<p>Then provide alternative “when-compiled-out” versions of the types for those fields.
(If the field is a list which, when enabled, uses <a href="list_builder/index.html" title="mod tor_config::list_builder"><code>list_builder</code></a>,
provide alternative “when-compiled-out” versions of the <em>entry</em> types.)</p>
<p>The <em>built</em> form of the configuration (<code>Field</code> or <code>Entry</code> in the case of a list),
should be a <code>#[non_exhaustive]</code> empty enum.
It should implement all the same standard traits as the compiled-in version.
So everything will compile.
But, since it is an uninhabited type, no such value can ever actually appear.</p>
<p>The <em>builder</em> form (<code>FieldBuilder</code> or <code>EntryBuilder</code>)
should be an empty <code>#[non_exhaustive]</code> struct.
It should have a trivial <code>Deserialize</code> impl which always returns successfully,
and a derived <code>Serialize</code> impl (and the usual traits).
This will allow configurations which attempt to specify such a value
to be recognised.</p>
<p>To get this to compile, naturally,
the builder will have to have a <code>.build()</code> method.
This should return <a href="enum.ConfigBuildError.html#variant.Invalid" title="variant tor_config::ConfigBuildError::Invalid"><code>ConfigBuildError::Invalid</code></a>.
(it can’t return the uninhabited built type, obviously.)
The configuration resolution arrangements are set up to call this,
and will report the error.</p>
<p>For an example, see <code>crates/tor-guardmgr/src/bridge_disabled.rs</code>.</p>
<hr />
<p>License: MIT OR Apache-2.0</p>
<!-- @@ end lint list maintained by maint/add_warning @@ --></div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.CmdLine"><code>pub use cmdline::<a class="struct" href="cmdline/struct.CmdLine.html" title="struct tor_config::cmdline::CmdLine">CmdLine</a>;</code></div></li><li><div class="item-name" id="reexport.MultilineListBuilder"><code>pub use list_builder::<a class="enum" href="list_builder/enum.MultilineListBuilder.html" title="enum tor_config::list_builder::MultilineListBuilder">MultilineListBuilder</a>;</code></div></li><li><div class="item-name" id="reexport.MultilineListBuilderError"><code>pub use list_builder::<a class="struct" href="list_builder/struct.MultilineListBuilderError.html" title="struct tor_config::list_builder::MultilineListBuilderError">MultilineListBuilderError</a>;</code></div></li><li><div class="item-name" id="reexport.resolve"><code>pub use load::<a class="fn" href="load/fn.resolve.html" title="fn tor_config::load::resolve">resolve</a>;</code></div></li><li><div class="item-name" id="reexport.resolve_ignore_warnings"><code>pub use load::<a class="fn" href="load/fn.resolve_ignore_warnings.html" title="fn tor_config::load::resolve_ignore_warnings">resolve_ignore_warnings</a>;</code></div></li><li><div class="item-name" id="reexport.resolve_return_results"><code>pub use load::<a class="fn" href="load/fn.resolve_return_results.html" title="fn tor_config::load::resolve_return_results">resolve_return_results</a>;</code></div></li><li><div class="item-name" id="reexport.ConfigurationSource"><code>pub use sources::<a class="enum" href="sources/enum.ConfigurationSource.html" title="enum tor_config::sources::ConfigurationSource">ConfigurationSource</a>;</code></div></li><li><div class="item-name" id="reexport.ConfigurationSources"><code>pub use sources::<a class="struct" href="sources/struct.ConfigurationSources.html" title="struct tor_config::sources::ConfigurationSources">ConfigurationSources</a>;</code></div></li><li><div class="item-name" id="reexport.config_crate"><code>pub use config as config_crate;</code></div></li><li><div class="item-name" id="reexport.educe"><code>pub use educe;</code></div></li><li><div class="item-name" id="reexport.serde"><code>pub use <a class="mod" href="https://docs.rs/serde/1.0.190/serde/index.html" title="mod serde">serde</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="cmdline/index.html" title="mod tor_config::cmdline">cmdline</a></div><div class="desc docblock-short">Implement a configuration source based on command-line arguments.</div></li><li><div class="item-name"><a class="mod" href="list_builder/index.html" title="mod tor_config::list_builder">list_builder</a></div><div class="desc docblock-short">Lists in builders</div></li><li><div class="item-name"><a class="mod" href="load/index.html" title="mod tor_config::load">load</a></div><div class="desc docblock-short">Processing a config::Config into a validated configuration</div></li><li><div class="item-name"><a class="mod" href="sources/index.html" title="mod tor_config::sources">sources</a></div><div class="desc docblock-short"><code>ConfigurationSources</code>: Helper for handling configuration files</div></li></ul><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.convert_helper_via_multi_line_list_builder.html" title="macro tor_config::convert_helper_via_multi_line_list_builder">convert_helper_via_multi_line_list_builder</a></div><div class="desc docblock-short">Implement <code>TryFrom&lt;MultilineListBuilder&gt;</code> and <code>Into&lt;MultilineListBuilder&gt;</code> for $Builder.</div></li><li><div class="item-name"><a class="macro" href="macro.define_list_builder_accessors.html" title="macro tor_config::define_list_builder_accessors">define_list_builder_accessors</a></div><div class="desc docblock-short">Define accessor methods for a configuration item which is a list</div></li><li><div class="item-name"><a class="macro" href="macro.define_list_builder_helper.html" title="macro tor_config::define_list_builder_helper">define_list_builder_helper</a></div><div class="desc docblock-short">Define a list builder struct for use with <a href="list_builder/macro.define_list_builder_accessors.html" title="macro tor_config::list_builder::define_list_builder_accessors"><code>define_list_builder_accessors</code></a></div></li><li><div class="item-name"><a class="macro" href="macro.derive_adhoc_template_Flattenable.html" title="macro tor_config::derive_adhoc_template_Flattenable">derive_adhoc_template_Flattenable</a></div><div class="desc docblock-short">Derives <a href="trait.Flattenable.html" title="trait tor_config::Flattenable"><code>Flattenable</code></a> for a struct</div></li><li><div class="item-name"><a class="macro" href="macro.impl_standard_builder.html" title="macro tor_config::impl_standard_builder">impl_standard_builder</a></div><div class="desc docblock-short">Defines standard impls for a struct with a <code>Builder</code>, incl <code>Default</code></div></li><li><div class="item-name"><a class="macro" href="macro.macro_first_nonempty.html" title="macro tor_config::macro_first_nonempty">macro_first_nonempty</a></div><div class="desc docblock-short">Helper for assisting with macro “argument” defaulting</div></li><li><div class="item-name"><a class="macro" href="macro.paste.html" title="macro tor_config::paste">paste</a></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CfgPath.html" title="struct tor_config::CfgPath">CfgPath</a></div><div class="desc docblock-short">A path in a configuration file: tilde expansion is performed, along
with expansion of certain variables.</div></li><li><div class="item-name"><a class="struct" href="struct.ConfigError.html" title="struct tor_config::ConfigError">ConfigError</a></div><div class="desc docblock-short">Wrapper for [<code>config::ConfigError</code>] with a more helpful error message.</div></li><li><div class="item-name"><a class="struct" href="struct.Flatten.html" title="struct tor_config::Flatten">Flatten</a></div><div class="desc docblock-short">Helper for flattening deserialisation, compatible with <a href="https://docs.rs/serde_ignored/0.1.9/serde_ignored/index.html" title="mod serde_ignored"><code>serde_ignored</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.InvalidBoolOrAuto.html" title="struct tor_config::InvalidBoolOrAuto">InvalidBoolOrAuto</a></div><div class="desc docblock-short">Boolean or <code>&quot;auto&quot;</code> configuration is invalid</div></li><li><div class="item-name"><a class="struct" href="struct.Listen.html" title="struct tor_config::Listen">Listen</a></div><div class="desc docblock-short">Specification of (possibly) something to listen on (eg, a port, or some addresses/ports)</div></li><li><div class="item-name"><a class="struct" href="struct.ListenUnsupported.html" title="struct tor_config::ListenUnsupported">ListenUnsupported</a></div><div class="desc docblock-short"><a href="struct.Listen.html" title="struct tor_config::Listen"><code>Listen</code></a> configuration specified something not supported by application code</div></li><li><div class="item-name"><a class="struct" href="struct.MutCfg.html" title="struct tor_config::MutCfg">MutCfg</a></div><div class="desc docblock-short">A mutable configuration object.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.BoolOrAuto.html" title="enum tor_config::BoolOrAuto">BoolOrAuto</a></div><div class="desc docblock-short">Boolean, but with additional <code>&quot;auto&quot;</code> option</div></li><li><div class="item-name"><a class="enum" href="enum.CfgPathError.html" title="enum tor_config::CfgPathError">CfgPathError</a></div><div class="desc docblock-short">An error that has occurred while expanding a path.</div></li><li><div class="item-name"><a class="enum" href="enum.ConfigBuildError.html" title="enum tor_config::ConfigBuildError">ConfigBuildError</a></div><div class="desc docblock-short">An error related to an option passed to Arti via a configuration
builder.</div></li><li><div class="item-name"><a class="enum" href="enum.InvalidListen.html" title="enum tor_config::InvalidListen">InvalidListen</a></div><div class="desc docblock-short">Listen configuration is invalid</div></li><li><div class="item-name"><a class="enum" href="enum.PaddingLevel.html" title="enum tor_config::PaddingLevel">PaddingLevel</a></div><div class="desc docblock-short">Padding enablement - rough amount of padding requested</div></li><li><div class="item-name"><a class="enum" href="enum.Reconfigure.html" title="enum tor_config::Reconfigure">Reconfigure</a></div><div class="desc docblock-short">Rules for reconfiguring a running Arti instance.</div></li><li><div class="item-name"><a class="enum" href="enum.ReconfigureError.html" title="enum tor_config::ReconfigureError">ReconfigureError</a></div><div class="desc docblock-short">An error caused when attempting to reconfigure an existing Arti client, or one of its modules.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Flattenable.html" title="trait tor_config::Flattenable">Flattenable</a></div><div class="desc docblock-short">Types that can be used with <a href="struct.Flatten.html" title="struct tor_config::Flatten"><code>Flatten</code></a></div></li><li><div class="item-name"><a class="trait" href="trait.Itertools.html" title="trait tor_config::Itertools">Itertools</a></div><div class="desc docblock-short">An <a href="https://doc.rust-lang.org/nightly/core/iter/traits/iterator/trait.Iterator.html" title="trait core::iter::traits::iterator::Iterator"><code>Iterator</code></a> blanket implementation that provides extra adaptors and
methods.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.resolve_alternative_specs.html" title="fn tor_config::resolve_alternative_specs">resolve_alternative_specs</a></div><div class="desc docblock-short">Helper for resolving a config item which can be specified in multiple ways</div></li><li><div class="item-name"><a class="fn" href="fn.resolve_option.html" title="fn tor_config::resolve_option">resolve_option</a></div><div class="desc docblock-short">Resolves an <code>Option&lt;Option&lt;T&gt;&gt;</code> (in a builder) into an <code>Option&lt;T&gt;</code></div></li><li><div class="item-name"><a class="fn" href="fn.resolve_option_general.html" title="fn tor_config::resolve_option_general">resolve_option_general</a></div><div class="desc docblock-short">Resolves an <code>Option&lt;Option&lt;T&gt;&gt;</code> (in a builder) into an <code>Option&lt;T&gt;</code>, more generally</div></li></ul></section></div></main></body></html>